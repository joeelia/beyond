<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SSL Support | Laravel WebSockets 🛰</title>
    <meta name="description" content="WebSockets for Laravel. Done right.">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css" rel="stylesheet" type="text/css">
    
    <link rel="preload" href="/laravel-websockets/assets/css/0.styles.d23a6950.css" as="style"><link rel="preload" href="/laravel-websockets/assets/js/app.be755737.js" as="script"><link rel="preload" href="/laravel-websockets/assets/js/7.962ed742.js" as="script"><link rel="prefetch" href="/laravel-websockets/assets/js/10.6e877d46.js"><link rel="prefetch" href="/laravel-websockets/assets/js/11.d328b102.js"><link rel="prefetch" href="/laravel-websockets/assets/js/12.58c66a3b.js"><link rel="prefetch" href="/laravel-websockets/assets/js/13.944ef160.js"><link rel="prefetch" href="/laravel-websockets/assets/js/14.3370b42f.js"><link rel="prefetch" href="/laravel-websockets/assets/js/15.a67e5211.js"><link rel="prefetch" href="/laravel-websockets/assets/js/16.376b6117.js"><link rel="prefetch" href="/laravel-websockets/assets/js/17.3da46033.js"><link rel="prefetch" href="/laravel-websockets/assets/js/2.0757df4b.js"><link rel="prefetch" href="/laravel-websockets/assets/js/3.8f17d77f.js"><link rel="prefetch" href="/laravel-websockets/assets/js/4.036088d7.js"><link rel="prefetch" href="/laravel-websockets/assets/js/5.b53140c4.js"><link rel="prefetch" href="/laravel-websockets/assets/js/6.18dd344c.js"><link rel="prefetch" href="/laravel-websockets/assets/js/8.34981749.js"><link rel="prefetch" href="/laravel-websockets/assets/js/9.2c249195.js">
    <link rel="stylesheet" href="/laravel-websockets/assets/css/0.styles.d23a6950.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/laravel-websockets/" class="home-link router-link-active"><!----> <span class="site-name">Laravel WebSockets 🛰</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/beyondcode/laravel-websockets" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div class="websocket-link can-hide"><a>0 users reading the documentation</a> <a><div class="notification"></div></a></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"> <a href="https://github.com/beyondcode/laravel-websockets" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/laravel-websockets/1.0/getting-started/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/laravel-websockets/1.0/getting-started/installation.html" class="sidebar-link">Installation</a></li><li><a href="/laravel-websockets/1.0/getting-started/questions-issues.html" class="sidebar-link">Questions and issues</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Basic Usage</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/laravel-websockets/1.0/basic-usage/pusher.html" class="sidebar-link">Pusher Replacement</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/pusher.html#requirements" class="sidebar-link">Requirements</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/pusher.html#pusher-configuration" class="sidebar-link">Pusher Configuration</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/pusher.html#configuring-websocket-apps" class="sidebar-link">Configuring WebSocket Apps</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/pusher.html#usage-with-laravel-echo" class="sidebar-link">Usage with Laravel Echo</a></li></ul></li><li><a href="/laravel-websockets/1.0/basic-usage/starting.html" class="sidebar-link">Starting the WebSocket server</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/starting.html#using-a-different-port" class="sidebar-link">Using a different port</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/starting.html#restricting-the-listening-host" class="sidebar-link">Restricting the listening host</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/starting.html#keeping-the-socket-server-running-with-supervisord" class="sidebar-link">Keeping the socket server running with supervisord</a></li></ul></li><li><a href="/laravel-websockets/1.0/basic-usage/ssl.html" class="active sidebar-link">SSL Support</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/ssl.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/ssl.html#client-configuration" class="sidebar-link">Client configuration</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/ssl.html#server-configuration" class="sidebar-link">Server configuration</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/ssl.html#usage-with-laravel-valet" class="sidebar-link">Usage with Laravel Valet</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/basic-usage/ssl.html#usage-with-a-reverse-proxy-like-nginx" class="sidebar-link">Usage with a reverse proxy (like Nginx)</a></li></ul></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Debugging</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/laravel-websockets/1.0/debugging/console.html" class="sidebar-link">Console Logging</a></li><li><a href="/laravel-websockets/1.0/debugging/dashboard.html" class="sidebar-link">Debug Dashboard</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/debugging/dashboard.html#accessing-the-dashboard" class="sidebar-link">Accessing the Dashboard</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/debugging/dashboard.html#protecting-the-dashboard" class="sidebar-link">Protecting the Dashboard</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/debugging/dashboard.html#statistics" class="sidebar-link">Statistics</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/debugging/dashboard.html#cleanup-old-statistics" class="sidebar-link">Cleanup old Statistics</a></li><li class="sidebar-sub-header"><a href="/laravel-websockets/1.0/debugging/dashboard.html#event-creator" class="sidebar-link">Event Creator</a></li></ul></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Advanced usage</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/laravel-websockets/1.0/advanced-usage/app-providers.html" class="sidebar-link">Custom App Providers</a></li><li><a href="/laravel-websockets/1.0/advanced-usage/custom-websocket-handlers.html" class="sidebar-link">Custom WebSocket Handlers</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>FAQ</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/laravel-websockets/1.0/faq/deploying.html" class="sidebar-link">Deploying</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/laravel-websockets/1.0/faq/scaling.html" class="sidebar-link">... but does it scale?</a></li></ul></div></li></ul>  <div class="sidebar-heading sidebar-footer">
      Built by <a href="https://beyondco.de" target="_blank">Beyond Code</a> and <a href="https://spatie.be">Spatie</a>.
    </div></div> <div class="page"> <div class="content"><h1 id="ssl-support"><a href="#ssl-support" aria-hidden="true" class="header-anchor">#</a> SSL Support</h1> <p>Since most of the web's traffic is going through HTTPS, it's also crucial to secure your WebSocket server. Luckily, adding SSL support to this package is really simple.</p> <h2 id="configuration"><a href="#configuration" aria-hidden="true" class="header-anchor">#</a> Configuration</h2> <p>The SSL configuration takes place in your <code>config/websockets.php</code> file.
The default configuration has a SSL section that looks like this:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'ssl'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token comment">/*
     * Path to local certificate file on filesystem. It must be a PEM encoded file which
     * contains your certificate and private key. It can optionally contain the
     * certificate chain of issuers. The private key also may be contained
     * in a separate file specified by local_pk.
     */</span>
    <span class="token single-quoted-string string">'local_cert'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">null</span><span class="token punctuation">,</span>

    <span class="token comment">/*
     * Path to local private key file on filesystem in case of separate files for
     * certificate (local_cert) and private key.
     */</span>
    <span class="token single-quoted-string string">'local_pk'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">null</span><span class="token punctuation">,</span>

    <span class="token comment">/*
     * Passphrase with which your local_cert file was encoded.
     */</span>
    <span class="token single-quoted-string string">'passphrase'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">null</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>But this is only a subset of all the available configuration options.
This packages makes use of the official PHP <a href="http://php.net/manual/en/context.ssl.php" target="_blank" rel="noopener noreferrer">SSL context options<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>So if you find yourself in the need of adding additional configuration settings, take a look at the PHP documentation and simply add the configuration parameters that you need.</p> <p>After setting up your SSL settings, you can simply (re)start your WebSocket server using:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan websockets:serve
</code></pre></div><h2 id="client-configuration"><a href="#client-configuration" aria-hidden="true" class="header-anchor">#</a> Client configuration</h2> <p>When your SSL settings are in place and working, you still need to tell Laravel Echo that it should make use of it.
You can do this by specifying the <code>encrypted</code> property in your JavaScript file, like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Echo <span class="token keyword">from</span> <span class="token string">&quot;laravel-echo&quot;</span>

window<span class="token punctuation">.</span>Pusher <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pusher-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>Echo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token punctuation">:</span> <span class="token string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token punctuation">:</span> <span class="token string">'your-pusher-key'</span><span class="token punctuation">,</span>
    wsHost<span class="token punctuation">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname<span class="token punctuation">,</span>
    wsPort<span class="token punctuation">:</span> <span class="token number">6001</span><span class="token punctuation">,</span>
    disableStats<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    encrypted<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="server-configuration"><a href="#server-configuration" aria-hidden="true" class="header-anchor">#</a> Server configuration</h2> <p>When broadcasting events from your Laravel application to the WebSocket server, you also need to tell Laravel to make use of HTTPS instead of HTTP. You can do this by setting the <code>scheme</code> option in your <code>config/broadcasting.php</code> file to <code>https</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'pusher'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'pusher'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'key'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_SECRET'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'app_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_ID'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'options'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'cluster'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_CLUSTER'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'127.0.0.1'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'port'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">6001</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scheme'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'https'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>Since the SSL configuration can vary quite a lot, depending on your setup, let's take a look at the most common approaches.</p> <h2 id="usage-with-laravel-valet"><a href="#usage-with-laravel-valet" aria-hidden="true" class="header-anchor">#</a> Usage with Laravel Valet</h2> <p>Laravel Valet uses self-signed SSL certificates locally.
To use self-signed certificates with Laravel WebSockets, here's how the SSL configuration section in your <code>config/websockets.php</code> file should look like.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Make sure that you replace <code>YOUR-USERNAME</code> with your Mac username and <code>VALET-SITE.TLD</code> with the host of the Valet site that you're working on right now. For example <code>laravel-websockets-demo.test</code>.</p></div> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'ssl'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token comment">/*
     * Path to local certificate file on filesystem. It must be a PEM encoded file which
     * contains your certificate and private key. It can optionally contain the
     * certificate chain of issuers. The private key also may be contained
     * in a separate file specified by local_pk.
     */</span>
    <span class="token single-quoted-string string">'local_cert'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'/Users/YOUR-USERNAME/.config/valet/Certificates/VALET-SITE.TLD.crt'</span><span class="token punctuation">,</span>

    <span class="token comment">/*
     * Path to local private key file on filesystem in case of separate files for
     * certificate (local_cert) and private key.
     */</span>
    <span class="token single-quoted-string string">'local_pk'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'/Users/YOUR-USERNAME/.config/valet/Certificates/VALET-SITE.TLD.key'</span><span class="token punctuation">,</span>

    <span class="token comment">/*
     * Passphrase with which your local_cert file was encoded.
     */</span>
    <span class="token single-quoted-string string">'passphrase'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">null</span><span class="token punctuation">,</span>

    <span class="token single-quoted-string string">'verify_peer'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>Next, you need to adjust the <code>config/broadcasting.php</code> file to make use of a secure connection when broadcasting messages from Laravel to the WebSocket server.</p> <p>You also need to disable SSL verification.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'pusher'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'pusher'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'key'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_SECRET'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'app_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_ID'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'options'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'cluster'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUSHER_APP_CLUSTER'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'127.0.0.1'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'port'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">6001</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scheme'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'https'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'curl_options'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
            <span class="token constant">CURLOPT_SSL_VERIFYHOST</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token constant">CURLOPT_SSL_VERIFYPEER</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>Last but not least, you still need to configure Laravel Echo to also use WSS on port 6001.</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>Echo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Echo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    broadcaster<span class="token punctuation">:</span> <span class="token string">'pusher'</span><span class="token punctuation">,</span>
    key<span class="token punctuation">:</span> <span class="token string">'your-pusher-key'</span><span class="token punctuation">,</span>
    wsHost<span class="token punctuation">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname<span class="token punctuation">,</span>
    wsPort<span class="token punctuation">:</span> <span class="token number">6001</span><span class="token punctuation">,</span>
    wssPort<span class="token punctuation">:</span> <span class="token number">6001</span><span class="token punctuation">,</span>
    disableStats<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="usage-with-a-reverse-proxy-like-nginx"><a href="#usage-with-a-reverse-proxy-like-nginx" aria-hidden="true" class="header-anchor">#</a> Usage with a reverse proxy (like Nginx)</h2> <p>Alternatively, you can also use a proxy service - like Nginx, HAProxy or Caddy - to handle the SSL configurations and proxy all requests in plain HTTP to your echo server.</p> <p>A basic Nginx configuration would look like this, but you might want to tweak the SSL parameters to your liking.</p> <div class="language- extra-class"><pre class="language-text"><code>server {
  listen        443 ssl;
  listen        [::]:443 ssl;
  server_name   socket.yourapp.tld;

  # Start the SSL configurations
  ssl                  on;
  ssl_certificate      /etc/letsencrypt/socket.yourapp.tld/fullchain.pem;
  ssl_certificate_key  /etc/letsencrypt/socket.yourapp.tld/privkey.pem;

  location / {
    proxy_pass             http://127.0.0.1:6001;
    proxy_read_timeout     60;
    proxy_connect_timeout  60;
    proxy_redirect         off;

    # Allow the use of websockets
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
  }
}
</code></pre></div><p>You can now talk HTTPS to <code>socket.yourapp.tld</code>. You would configure your <code>config/broadcasting.php</code> like the example above, treating your socket server as an <code>https</code> endpoint.</p> <h3 id="same-location-for-websockets-and-web-contents"><a href="#same-location-for-websockets-and-web-contents" aria-hidden="true" class="header-anchor">#</a> Same location for websockets and web contents</h3> <p>To have the websockets be served at the same location and port as your other web content, Nginx can be teached to map incoming requests based on their type to special sub-locations.</p> <div class="language- extra-class"><pre class="language-text"><code>map $http_upgrade $type {
  default &quot;web&quot;;
  websocket &quot;ws&quot;;
}

server {
  # Your default configuration comes here...

  location / {
    try_files /nonexistent @$type;
  }
  
  location @web {
    try_files $uri $uri/ /index.php?$query_string;
  }

  location @ws {
    proxy_pass             http://127.0.0.1:6001;
    proxy_set_header Host  $host;
    proxy_read_timeout     60;
    proxy_connect_timeout  60;
    proxy_redirect         off;

    # Allow the use of websockets
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
  }
}
</code></pre></div><p>This configuration is useful if you do not want to open multiple ports or you are restricted to which ports are already opened on your server. Alternatively, a second Nginx location can be used on the server-side, while the Pusher configuration <a href="https://github.com/pusher/pusher-js#wspath" target="_blank" rel="noopener noreferrer"><code>wsPath</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> can be used on the client-side (<em>note: <code>&quot;pusher-js&quot;: &quot;&gt;=4.2.2&quot;</code> is required for this configuration option</em>).</p> <div class="language- extra-class"><pre class="language-text"><code>server {
  # Your default configuration comes here...

  location /ws {
    proxy_pass             http://127.0.0.1:6001;
    proxy_set_header Host  $host;
    proxy_read_timeout     60;
    proxy_connect_timeout  60;
    proxy_redirect         off;

    # Allow the use of websockets
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
  }
}
</code></pre></div><h3 id="nginx-worker-connections"><a href="#nginx-worker-connections" aria-hidden="true" class="header-anchor">#</a> Nginx worker connections</h3> <p>Note that you might need to increase the amount of <code>worker_connections</code> in Nginx. Your WebSocket connections will now be sent to Nginx, which in turn will send those along to the websocket server.</p> <p>By default, that will have a sane limit of 1024 connections. If you are expecting more concurrent connections to your WebSockets, you can increase this in your global <code>nginx.conf</code>.</p> <div class="language- extra-class"><pre class="language-text"><code>events {
    worker_connections  1024;
}
</code></pre></div><p>You know you've reached this limit of your Nginx error logs contain similar messages to these:</p> <div class="language- extra-class"><pre class="language-text"><code>[alert] 1024 worker_connections are not enough while connecting to upstream
</code></pre></div><p>Remember to restart your Nginx after you've modified the <code>worker_connections</code>.</p> <h3 id="example-using-caddy"><a href="#example-using-caddy" aria-hidden="true" class="header-anchor">#</a> Example using Caddy</h3> <p><a href="https://caddyserver.com" target="_blank" rel="noopener noreferrer">Caddy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> can also be used to automatically obtain a TLS certificate from Let's Encrypt and terminate TLS before proxying to your echo server.</p> <p>An example configuration would look like this:</p> <div class="language- extra-class"><pre class="language-text"><code>socket.yourapp.tld {
    rewrite / {
        if {&gt;Connection} is Upgrade
        if {&gt;Upgrade} is websocket
        to /special-websocket-url
    }

    proxy /special-websocket-url ws://127.0.0.1:6001 {
        without /special-websocket-url
        transparent
        websocket
    }
    
    tls youremail.com
}
</code></pre></div><p>Note the <code>to /special-websocket-url</code>, this is a dummy path to allow the <code>proxy</code> directive to only proxy on websocket connections. This should be a path that will never be used by your application's routing.</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/beyondcode/docs.beyondco.de/edit/master/resources/docs/laravel-websockets/1.0/basic-usage/ssl.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/laravel-websockets/1.0/basic-usage/starting.html" class="prev">
          Starting the WebSocket server
        </a></span> <span class="next"><a href="/laravel-websockets/1.0/debugging/console.html">
          Console Logging
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/laravel-websockets/assets/js/7.962ed742.js" defer></script><script src="/laravel-websockets/assets/js/app.be755737.js" defer></script>
  </body>
</html>
